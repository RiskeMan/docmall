<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.docmall.mapper.OrderMapper">

	<select id="getOrderseq" resultType="int">
      SELECT SEQ_ORD_CODE.NEXTVAL FROM DUAL
	</select>
   
	<insert id="order_insert">

		Insert INTO
			ORDER_TBL(ORD_CODE, MBSP_ID, ORD_NAME, ORD_ZIPCODE, ORD_ADDR_BASIC, ORD_ADDR_DETAIL, ORD_TEL, ORD_PRICE, ORD_REGDATE, ORD_STATUS, PAYMENT_STATUS)
		VALUES
			(#{ord_code}, #{mbsp_id}, #{ord_name}, #{ord_zipcode}, #{ord_addr_basic}, #{ord_addr_detail}, #{ord_tel}, #{ord_price}, SYSDATE, #{ord_status}, #{payment_status})

	</insert>
   
	<insert id="order_detail_insert" parameterType="map">
	
	INSERT INTO
		ORDETAIL_TBL(ORD_CODE, PRO_NUM, DT_AMOUNT, DT_PRICE)
	SELECT
		#{ord_code}, c.PRO_NUM, c.CART_AMOUNT, p.PRO_PRICE
	FROM
		CART_TBL c INNER JOIN PRODUCT_TBL p on c.PRO_NUM = p.PRO_NUM
	WHERE
		MBSP_ID = #{mbsp_id}
	
	</insert>
   
	<delete id="cart_del">
	
		DELETE FROM
			CART_TBL
		WHERE
			MBSP_ID = #{mbsp_id}
	
	</delete>

</mapper>